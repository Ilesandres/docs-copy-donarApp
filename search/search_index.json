{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to DonarApp Documentation","text":"<p>DonarApp is a platform designed to facilitate donations between donors and organizations. This project consists of two main components:</p> <ul> <li>Frontend: Built with Angular, providing the user interface for donors and organizations.</li> <li>Backend: Built with NestJS, providing the REST API to manage data and business logic.</li> </ul>"},{"location":"#repositories","title":"Repositories","text":"<p>The source code for this project is available on GitHub:</p> <ul> <li>Backend Repository: https://github.com/DonacionApp/DonaApp</li> <li>Frontend Repository: https://github.com/DonacionApp/Frontend</li> </ul>"},{"location":"#quick-navigation","title":"Quick Navigation","text":""},{"location":"#backend-api-documentation","title":"Backend API Documentation","text":"<p>The backend documentation is complete and covers all aspects of the API:</p> <ul> <li>Overview - Introduction to the backend architecture and Postman collection</li> <li>Configuration - Environment variables and external API integrations</li> <li>Modules - Complete list of all 36 backend modules</li> <li>Controllers - API endpoints grouped by functionality and role</li> <li>Services - Business logic layer documentation</li> <li>Entities - Database schema and entity relationships</li> <li>How It Works - Code examples and workflow explanations</li> </ul>"},{"location":"#frontend-documentation","title":"Frontend Documentation","text":"<p>Coming Soon - Frontend documentation is currently in progress.</p>"},{"location":"#project-structure","title":"Project Structure","text":"<p>The project is organized as follows:</p> <ul> <li><code>/fontnd-donarApp/frontend</code>: Angular Frontend application</li> <li><code>/DonaApp/backend</code>: NestJS Backend API</li> <li><code>/docs</code>: This documentation</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#backend-development","title":"Backend Development","text":"<ol> <li>Navigate to the Backend Overview to understand the architecture</li> <li>Check the Configuration to set up your environment variables</li> <li>Explore the Postman Collection to test the API</li> <li>Read How It Works to understand the core workflows</li> </ol>"},{"location":"#frontend-development","title":"Frontend Development","text":"<p>Frontend documentation will be available soon. In the meantime, refer to the backend API documentation to understand the available endpoints.</p>"},{"location":"backend/","title":"Backend Overview","text":"<p>The DonarApp backend is built using NestJS, a progressive Node.js framework for building efficient, reliable and scalable server-side applications.</p>"},{"location":"backend/#key-technologies","title":"Key Technologies","text":"<ul> <li>NestJS: Core framework.</li> <li>TypeScript: Language.</li> <li>TypeORM  ORM for database interaction.</li> <li>PostgreSQL/MySQL  Database.</li> </ul>"},{"location":"backend/#architecture","title":"Architecture","text":"<p>The backend follows the standard NestJS modular architecture:</p> <ul> <li>Modules: Encapsulate related code (controllers, services, etc.).</li> <li>Controllers: Handle incoming HTTP requests and return responses.</li> <li>Services: Contain the business logic.</li> <li>Entities: Define the data structure and database schema.</li> </ul>"},{"location":"backend/#api-documentation-testing","title":"API Documentation &amp; Testing","text":"<p>You can explore and test the complete API endpoints using our public Postman Collection:</p> <p></p> <ul> <li>View Collection: DonarApp Postman Collection</li> </ul>"},{"location":"backend/configuration/","title":"Configuration and Environment Variables","text":"<p>The backend application uses environment variables for configuration, including database connections, JWT settings, email services, and external API integrations.</p>"},{"location":"backend/configuration/#environment-variables","title":"Environment Variables","text":"<p>The <code>.env</code> file should be created in the root of the backend project. You can use <code>.env.example</code> as a template.</p>"},{"location":"backend/configuration/#general","title":"General","text":"<ul> <li><code>APP_PORT</code>: Port where the application will run (e.g., <code>5000</code>).</li> </ul>"},{"location":"backend/configuration/#database-postgresql","title":"Database (PostgreSQL)","text":"<ul> <li><code>DB_HOST</code>: Database host (e.g., <code>localhost</code>).</li> <li><code>DB_PORT</code>: Database port (e.g., <code>5432</code>).</li> <li><code>DB_USER</code>: Database username.</li> <li><code>DB_PASS</code>: Database password.</li> <li><code>DB_NAME</code>: Database name.</li> </ul>"},{"location":"backend/configuration/#authentication-jwt","title":"Authentication (JWT)","text":"<ul> <li><code>JWT_SECRET</code>: Secret key for signing JWT tokens.</li> <li><code>JWT_EXPIRES_IN</code>: Token expiration time (e.g., <code>15m</code>).</li> </ul>"},{"location":"backend/configuration/#external-apis","title":"External APIs","text":""},{"location":"backend/configuration/#countries-api-location","title":"Countries API (Location)","text":"<p>Used to fetch countries, states, and cities data. *   <code>URL_COUNTRIES_API</code>: Base URL for the Countries API. *   <code>API_KEY_COUNTRIES_API</code>: API Key for authentication.</p>"},{"location":"backend/configuration/#sentiment-analysis-pysentimiento","title":"Sentiment Analysis (Pysentimiento)","text":"<p>Used to analyze the sentiment of donation reviews and assign a rating (0-5). *   <code>MICROSERVICONSENTIMENTS_URL</code>: Primary URL for the sentiment analysis microservice. *   <code>MICROSERVICONSENTIMENTS_URL_AUX</code>: Auxiliary URL for the sentiment analysis microservice (fallback).</p>"},{"location":"backend/configuration/#email-service","title":"Email Service","text":"<ul> <li><code>MAIL_HOST</code>: SMTP host.</li> <li><code>MAIL_USER</code>: SMTP username.</li> <li><code>MAIL_PASSWORD</code>: SMTP password.</li> <li><code>MAIL_FROM</code>: Sender email address.</li> <li><code>MAIL_PORT</code>: SMTP port.</li> </ul>"},{"location":"backend/configuration/#frontend-integration","title":"Frontend Integration","text":"<ul> <li><code>URL_FRONTEND</code>: Base URL of the frontend application.</li> <li><code>URL_FRONTEND_VERIFY_TOKEN</code>: Path for email token verification.</li> <li><code>URL_FRONTEND_VERIFY</code>: Path for email verification.</li> <li><code>URL_FRONTEND_RESET_PASS_TOKEN</code>: Path for password reset token.</li> </ul>"},{"location":"backend/configuration/#cloudinary-file-uploads","title":"Cloudinary (File Uploads)","text":"<ul> <li><code>CLOUDINARY_NAME</code>: Cloud name.</li> <li><code>CLOUDINARY_API_KEY</code>: API Key.</li> <li><code>CLOUDINARY_API_SECRET</code>: API Secret.</li> <li><code>CLOUDINARY_FOLDER_BASE</code>: Base folder for uploads.</li> <li><code>CLOUDINARY_PROFILE_FOLDER</code>: Folder for profile photos.</li> <li><code>CLOUDINARY_DOCS_FOLDER</code>: Folder for documents.</li> <li><code>CLOUDINARY_CHATS_FOLDER</code>: Folder for chat images.</li> <li><code>CLOUDINARY_POST_FOLDER</code>: Folder for post images.</li> </ul>"},{"location":"backend/configuration/#aws-optional-backup-ai","title":"AWS (Optional / Backup AI)","text":"<p>Used as a fallback for image processing (AWS Rekognition) if the primary AI service (Gemini) fails. *   <code>AWS_REGION</code>: AWS Region. *   <code>AWS_ACCESS_KEY_ID</code>: AWS Access Key ID. *   <code>AWS_SECRET_ACCESS_KEY</code>: AWS Secret Access Key.</p>"},{"location":"backend/configuration/#ai-integration","title":"AI Integration","text":"<ul> <li><code>GEMINI_API_KEY</code>: API Key for Gemini (if used).</li> </ul>"},{"location":"backend/configuration/#external-api-integrations","title":"External API Integrations","text":""},{"location":"backend/configuration/#country-state-city-api","title":"Country State City API","text":"<p>The application integrates with an external API to provide location data (Countries, States, Cities). This is handled by the <code>CountriesService</code>. *   Official Documentation: https://docs.countrystatecity.in/ *   Usage: Registration, Profile updates.</p>"},{"location":"backend/configuration/#pysentimiento-sentiment-analysis","title":"Pysentimiento (Sentiment Analysis)","text":"<p>The application uses a microservice ( Python-based using <code>pysentimiento</code>) to analyze the text of donation reviews. *   Usage: When a user leaves a review for a donation (<code>DonationReviewService</code>). *   Function: Analyzes the review text and returns a sentiment score (converted to a 1-5 rating).</p>"},{"location":"backend/controllers/","title":"Controllers (API Endpoints)","text":"<p>Controllers are the entry points for the API. They handle incoming HTTP requests, validate data, and delegate business logic to services. Below is a detailed breakdown of the available endpoints, grouped by their functional module and access level.</p>"},{"location":"backend/controllers/#authentication-auth","title":"Authentication (<code>Auth</code>)","text":"<p>Controller: <code>auth.controller.ts</code> Purpose: Manages user registration, login, and account verification.</p> Endpoint Method Description Auth Required <code>/auth/login</code> <code>POST</code> Authenticates a user with email and password. Returns a JWT <code>access_token</code> for subsequent requests. No <code>/auth/register</code> <code>POST</code> Registers a new user in the system. Requires personal information and location data. No <code>/auth/verify-email-token</code> <code>POST</code> Verifies a user's email address using a token sent via email. No <code>/auth/verify-email-code</code> <code>POST</code> Verifies a user's email address using a numeric code. No <code>/auth/forgot-password</code> <code>POST</code> Initiates the password recovery process by sending a reset link/code to the user's email. No"},{"location":"backend/controllers/#users-user","title":"Users (<code>User</code>)","text":"<p>Controller: <code>user.controller.ts</code> Purpose: Handles user profile management, retrieval, and administrative actions.</p>"},{"location":"backend/controllers/#public-shared","title":"Public / Shared","text":"<p>Endpoints accessible to everyone or authenticated users without special roles.</p> <ul> <li>Get User Profile (Detailed)<ul> <li><code>GET /user/:id</code></li> <li>Retrieves full public profile details for a specific user by their ID.</li> </ul> </li> <li>Get User Profile (By Username)<ul> <li><code>GET /user/username/:username</code></li> <li>Retrieves profile details using the unique username.</li> </ul> </li> <li>Get Minimal Profile<ul> <li><code>GET /user/minimal/:id</code></li> <li>Returns a simplified version of the user profile (name, photo, basic info).</li> </ul> </li> <li>List Organizations<ul> <li><code>GET /user/minimal/all/organizations</code></li> <li>Retrieves a paginated list of registered organizations. Useful for directories or search.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#admin-only","title":"Admin Only","text":"<p>Endpoints restricted to users with the <code>ADMIN</code> role.</p> <ul> <li>List All Users<ul> <li><code>GET /user</code></li> <li>Retrieves a paginated list of all users in the system.</li> </ul> </li> <li>Create User (Admin)<ul> <li><code>POST /user</code></li> <li>Allows an admin to manually create a new user account.</li> </ul> </li> <li>Update User (Admin)<ul> <li><code>POST /user/update/:id</code></li> <li>Updates any user's profile data.</li> </ul> </li> <li>Delete User<ul> <li><code>DELETE /user/delete/:id</code></li> <li>Permanently removes a user from the system.</li> </ul> </li> <li>Change User Role<ul> <li><code>POST /user/change-role/:id</code></li> <li>Promotes or demotes a user (e.g., User to Admin).</li> </ul> </li> <li>Block/Unblock User<ul> <li><code>POST /user/change-block-status/:id</code></li> <li>Suspends or restores a user's access to the platform.</li> </ul> </li> <li>Review Support Documents<ul> <li><code>GET /user/upload-support</code></li> <li>Lists users who have uploaded verification documents for review.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#posts-post","title":"Posts (<code>Post</code>)","text":"<p>Controller: <code>post.controller.ts</code> Purpose: Manages donation requests and offers (posts).</p>"},{"location":"backend/controllers/#user-my-posts","title":"User (My Posts)","text":"<p>Endpoints for managing the current user's content.</p> <ul> <li>Create Post<ul> <li><code>POST /post/create</code></li> <li>Creates a new donation request or offer. Supports image uploads.</li> </ul> </li> <li>My Posts<ul> <li><code>GET /post/me/posts</code></li> <li>Lists all posts created by the logged-in user.</li> </ul> </li> <li>Update Post<ul> <li><code>POST /post/update/:id</code></li> <li>Edits the title, description, or details of a post.</li> </ul> </li> <li>Delete Post<ul> <li><code>DELETE /post/delete/:id</code></li> <li>Removes a post created by the user.</li> </ul> </li> <li>Manage Images<ul> <li><code>POST /post/image/add/:postId</code>: Uploads additional images to a post.</li> <li><code>DELETE /post/image/delete/:imageId/post/:postId</code>: Removes a specific image.</li> </ul> </li> <li>Manage Tags<ul> <li><code>POST /post/add/tag/:tagId/post/:postId</code>: Adds a tag (e.g., \"Food\", \"Clothes\") to a post.</li> <li><code>DELETE /post/remove/tag/:tagId/post/:postId</code>: Removes a tag.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#public","title":"Public","text":"<p>Endpoints for viewing posts.</p> <ul> <li>Feed / All Posts<ul> <li><code>GET /post/all</code></li> <li>Retrieves the main feed of posts with pagination.</li> </ul> </li> <li>Filter Posts<ul> <li><code>POST /post/all/filters</code></li> <li>Advanced search for posts based on categories, location, or keywords.</li> </ul> </li> <li>Post Details<ul> <li><code>GET /post/:id</code></li> <li>Retrieves the full details of a single post.</li> </ul> </li> <li>User's Posts<ul> <li><code>GET /post/user/:userId</code></li> <li>Lists all posts belonging to a specific user.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#admin-only_1","title":"Admin Only","text":"<ul> <li>Admin Update/Delete: Admins can update (<code>POST /post/update/admin/:id</code>) or delete (<code>DELETE /post/admin/delete/:id</code>) any post for moderation.</li> <li>Admin Tag/Image Management: Admins can add/remove tags and images from any post.</li> </ul>"},{"location":"backend/controllers/#donations-donation","title":"Donations (<code>Donation</code>)","text":"<p>Controller: <code>donation.controller.ts</code> Purpose: Manages the donation process, from initiation to completion.</p> <ul> <li>Create Donation<ul> <li><code>POST /donation</code></li> <li>Initiates a donation offer for a specific post.</li> </ul> </li> <li>My Donations (As Donor)<ul> <li><code>GET /donation/user</code></li> <li>Lists donations made by the current user.</li> </ul> </li> <li>Update Status<ul> <li><code>POST /donation/:id/status</code></li> <li>Updates the status of a donation (e.g., <code>PENDING</code> -&gt; <code>ACCEPTED</code>).</li> </ul> </li> <li>Admin Status Update<ul> <li><code>POST /donation/:id/status/admin</code></li> <li>Allows admins to force a status change on a donation.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#statistics-statistics","title":"Statistics (<code>Statistics</code>)","text":"<p>Controller: <code>statistics.controller.ts</code> Purpose: Provides analytics and ranking data.</p> <ul> <li>User Metrics: <code>GET /statistics/user/:id</code> - Stats for a specific user (donations made/received).</li> <li>Rankings:<ul> <li><code>GET /statistics/users/rankings</code>: General user rankings.</li> <li><code>GET /statistics/users/rankings/donations-made</code>: Top donors.</li> <li><code>GET /statistics/users/rankings/donations-received</code>: Top beneficiaries.</li> <li><code>GET /statistics/users/rankings/average-rating</code>: Highest rated users.</li> </ul> </li> <li>Public Stats: <code>GET /statistics/public</code> - General platform statistics.</li> </ul>"},{"location":"backend/controllers/#artificial-intelligence-ia","title":"Artificial Intelligence (<code>IA</code>)","text":"<p>Controller: <code>ia.controller.ts</code> Purpose: AI-powered features.</p> <ul> <li>Generate Tags from Image<ul> <li><code>POST /ia/tags-from-images</code></li> <li>Input: Image file(s).</li> <li>Output: A list of descriptive tags (e.g., <code>[\"Laptop\", \"Electronics\", \"Used\"]</code>).</li> <li>Logic: Uses Google Gemini (primary) or AWS Rekognition (backup) to analyze the image.</li> </ul> </li> </ul>"},{"location":"backend/controllers/#location-countries","title":"Location (<code>Countries</code>)","text":"<p>Controller: <code>countries.controller.ts</code> Purpose: Provides geographic data (Countries, States, Cities).</p> <ul> <li>List Countries: <code>GET /countries</code></li> <li>Get Country: <code>GET /countries/iso/:iso</code> or <code>GET /countries/id/:id</code></li> <li>List States: <code>GET /countries/states/iso/:iso</code> (By Country ISO)</li> <li>List Cities: <code>GET /countries/countries/:iso/states/:stateIso/cities</code> (By State)</li> </ul>"},{"location":"backend/controllers/#likes-postliked","title":"Likes (<code>PostLiked</code>)","text":"<p>Controller: <code>postLiked.controller.ts</code> Purpose: Manages likes on posts.</p> <ul> <li>List Likes: <code>GET /postliked/userslike/:postId</code> - See who liked a post.</li> <li>Add Like: <code>POST /postliked/addlike/:postId</code> - Like a post.</li> <li>Remove Like: <code>DELETE /postliked/removelike/:postId</code> - Unlike a post.</li> </ul>"},{"location":"backend/entities/","title":"Database Entities","text":"<p>The application uses TypeORM entities to map to the PostgreSQL database tables. Below is a comprehensive list of all entities in the system.</p>"},{"location":"backend/entities/#user-authentication","title":"User &amp; Authentication","text":""},{"location":"backend/entities/#user-userentityts","title":"User (<code>user.entity.ts</code>)","text":"<p>Represents a user in the system. *   <code>id</code>: Primary Key. *   <code>username</code>: Unique username. *   <code>email</code>: Unique email address. *   <code>password</code>: Hashed password. *   <code>rol</code>: Relation to <code>RolEntity</code>. *   <code>people</code>: Relation to <code>PeopleEntity</code> (Personal details). *   <code>profilePhoto</code>: URL to profile photo. *   <code>location</code>: User location data. *   <code>verified</code>: Boolean indicating if the user is verified. *   <code>block</code>: Boolean indicating if the user is blocked. *   <code>loginAttempts</code>: Number of failed login attempts. *   <code>lockUntil</code>: Timestamp until when the account is locked. *   <code>lastLogin</code>: Timestamp of the last login.</p>"},{"location":"backend/entities/#people-peopleentityts","title":"People (<code>people.entity.ts</code>)","text":"<p>Stores personal information linked to a user. *   <code>id</code>: Primary Key. *   <code>name</code>: First name. *   <code>lastName</code>: Last name. *   <code>dni</code>: Identification number. *   <code>typeDni</code>: Relation to <code>TypeDniEntity</code>. *   <code>birdthDate</code>: Date of birth. *   <code>residencia</code>: Residential address. *   <code>municipio</code>: Municipality/City data. *   <code>telefono</code>: Phone number. *   <code>supportId</code>: URL to support document (e.g., ID scan).</p>"},{"location":"backend/entities/#rol-rolentityts","title":"Rol (<code>rol.entity.ts</code>)","text":"<p>Defines user roles (e.g., Admin, User). *   <code>id</code>: Primary Key. *   <code>rol</code>: Role name (unique).</p>"},{"location":"backend/entities/#typedni-typednientityts","title":"TypeDni (<code>type.dni.entity.ts</code>)","text":"<p>Defines types of identification documents. *   <code>id</code>: Primary Key. *   <code>type</code>: Document type name (unique).</p>"},{"location":"backend/entities/#posts-content","title":"Posts &amp; Content","text":""},{"location":"backend/entities/#post-postentityts","title":"Post (<code>post.entity.ts</code>)","text":"<p>Represents a user's post (donation request or offer). *   <code>id</code>: Primary Key. *   <code>title</code>: Post title. *   <code>message</code>: Post content/description. *   <code>user</code>: Relation to <code>UserEntity</code> (Creator). *   <code>typePost</code>: Relation to <code>TypePostEntity</code>. *   <code>tags</code>: Relation to <code>PostTagEntity</code>. *   <code>imagePost</code>: Relation to <code>ImagePostEntity</code>. *   <code>postLiked</code>: Relation to <code>PostLikedEntity</code>. *   <code>postArticle</code>: Relation to <code>PostArticleEntity</code>.</p>"},{"location":"backend/entities/#typepost-typeportentityts","title":"TypePost (<code>type.port.entity.ts</code>)","text":"<p>Defines types of posts (e.g., Donation, Request). *   <code>id</code>: Primary Key. *   <code>type</code>: Post type name (unique).</p>"},{"location":"backend/entities/#imagepost-imagepostentityts","title":"ImagePost (<code>image.post.entity.ts</code>)","text":"<p>Stores images associated with a post. *   <code>id</code>: Primary Key. *   <code>post</code>: Relation to <code>PostEntity</code>. *   <code>image</code>: URL or path to the image.</p>"},{"location":"backend/entities/#postliked-postlikedentityts","title":"PostLiked (<code>post.liked.entity.ts</code>)","text":"<p>Tracks likes on posts. *   <code>id</code>: Primary Key. *   <code>post</code>: Relation to <code>PostEntity</code>. *   <code>user</code>: Relation to <code>UserEntity</code>.</p>"},{"location":"backend/entities/#tags-tagsentityts","title":"Tags (<code>tags.entity.ts</code>)","text":"<p>Defines tags that can be applied to posts. *   <code>id</code>: Primary Key. *   <code>tag</code>: Tag name (unique).</p>"},{"location":"backend/entities/#posttag-posttagsentityts","title":"PostTag (<code>post.tags.entity.ts</code>)","text":"<p>Associates tags with posts (Many-to-Many relationship). *   <code>id</code>: Primary Key. *   <code>post</code>: Relation to <code>PostEntity</code>. *   <code>tag</code>: Relation to <code>TagsEntity</code>.</p>"},{"location":"backend/entities/#donations","title":"Donations","text":""},{"location":"backend/entities/#donation-donationentityts","title":"Donation (<code>donation.entity.ts</code>)","text":"<p>Represents a donation transaction. *   <code>id</code>: Primary Key. *   <code>post</code>: Relation to <code>PostEntity</code>. *   <code>user</code>: Relation to <code>UserEntity</code> (Donor). *   <code>statusDonation</code>: Relation to <code>StatusDonationEntity</code>. *   <code>lugarRecogida</code>: Pickup location. *   <code>lugarDonacion</code>: Donation location. *   <code>fechaMaximaEntrega</code>: Deadline for delivery. *   <code>comments</code>: JSON field for additional comments. *   <code>reviewwDonation</code>: Relation to <code>DonationReviewEntity</code>. *   <code>chat</code>: Relation to <code>ChatEntity</code>.</p>"},{"location":"backend/entities/#statusdonation-statusdonationentityts","title":"StatusDonation (<code>status.donation.entity.ts</code>)","text":"<p>Defines possible statuses for a donation. *   <code>id</code>: Primary Key. *   <code>status</code>: Status name (unique).</p>"},{"location":"backend/entities/#donationreview-donationreviewentityts","title":"DonationReview (<code>donation.review.entity.ts</code>)","text":"<p>Stores reviews for completed donations. *   <code>id</code>: Primary Key. *   <code>review</code>: Text content of the review. *   <code>raiting</code>: Numerical rating (1-5). *   <code>user</code>: Relation to <code>UserEntity</code> (Reviewer). *   <code>donation</code>: Relation to <code>DonationEntity</code>.</p>"},{"location":"backend/entities/#articles-inventory","title":"Articles &amp; Inventory","text":""},{"location":"backend/entities/#article-articleentityts","title":"Article (<code>article.entity.ts</code>)","text":"<p>Represents a generic article or item type. *   <code>id</code>: Primary Key. *   <code>name</code>: Article name. *   <code>descripcion</code>: Description.</p>"},{"location":"backend/entities/#postarticle-postarticleentityts","title":"PostArticle (<code>postarticle.entity.ts</code>)","text":"<p>Associates articles with a post (items requested/offered). *   <code>id</code>: Primary Key. *   <code>article</code>: Relation to <code>ArticleEntity</code>. *   <code>post</code>: Relation to <code>PostEntity</code>. *   <code>quantity</code>: Quantity of the article. *   <code>status</code>: Relation to <code>StatusPostDonationArticle</code>.</p>"},{"location":"backend/entities/#postarticledonation-postarticledonationentityts","title":"PostArticleDonation (<code>post.article.donation.entity.ts</code>)","text":"<p>Tracks specific articles within a donation. *   <code>id</code>: Primary Key. *   <code>donation</code>: Relation to <code>DonationEntity</code>. *   <code>postArticle</code>: Relation to <code>PostArticleEntity</code>. *   <code>quantity</code>: Quantity donated.</p>"},{"location":"backend/entities/#statuspostdonationarticle-statuspostdonationarticleentityts","title":"StatusPostDonationArticle (<code>status.postdonationarticle.entity.ts</code>)","text":"<p>Defines statuses for articles within a donation post. *   <code>id</code>: Primary Key. *   <code>status</code>: Status name.</p>"},{"location":"backend/entities/#userarticle-useraticleentityts","title":"UserArticle (<code>useraticle.entity.ts</code>)","text":"<p>Associates articles with a user (e.g., user inventory or needs). *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>article</code>: Relation to <code>ArticleEntity</code>. *   <code>cant</code>: Quantity. *   <code>needed</code>: Boolean indicating if it's a need.</p>"},{"location":"backend/entities/#chat-messaging","title":"Chat &amp; Messaging","text":""},{"location":"backend/entities/#chat-chatentityts","title":"Chat (<code>chat.entity.ts</code>)","text":"<p>Represents a chat session. *   <code>id</code>: Primary Key. *   <code>chatName</code>: Name of the chat. *   <code>chatStatus</code>: Relation to <code>ChatStatusEntity</code>. *   <code>donation</code>: Relation to <code>DonationEntity</code>. *   <code>userChat</code>: Relation to <code>UserChatEntity</code>. *   <code>messageChat</code>: Relation to <code>MessageChatEntity</code>.</p>"},{"location":"backend/entities/#chatstatus-chatstatusentityts","title":"ChatStatus (<code>chat.status.entity.ts</code>)","text":"<p>Defines statuses for a chat. *   <code>id</code>: Primary Key. *   <code>status</code>: Status name (unique).</p>"},{"location":"backend/entities/#userchat-userchatentityts","title":"UserChat (<code>user.chat.entity.ts</code>)","text":"<p>Associates users with chat sessions. *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>chat</code>: Relation to <code>ChatEntity</code>. *   <code>donator</code>: Boolean indicating if the user is the donor. *   <code>admin</code>: Boolean indicating if the user is an admin.</p>"},{"location":"backend/entities/#messagechat-messagechatentityts","title":"MessageChat (<code>message.chat.entity.ts</code>)","text":"<p>Represents an individual message in a chat. *   <code>id</code>: Primary Key. *   <code>chat</code>: Relation to <code>ChatEntity</code>. *   <code>user</code>: Relation to <code>UserEntity</code> (Sender). *   <code>message</code>: Message content. *   <code>type</code>: Relation to <code>TypeMessageEntity</code>. *   <code>read</code>: Boolean indicating if the message has been read.</p>"},{"location":"backend/entities/#typemessage-typemessageentityts","title":"TypeMessage (<code>type.message.entity.ts</code>)","text":"<p>Defines types of messages (e.g., text, image). *   <code>id</code>: Primary Key. *   <code>type</code>: Message type name (unique).</p>"},{"location":"backend/entities/#notifications-system","title":"Notifications &amp; System","text":""},{"location":"backend/entities/#notify-notifyentityts","title":"Notify (<code>notify.entity.ts</code>)","text":"<p>Represents a system notification. *   <code>id</code>: Primary Key. *   <code>title</code>: Notification title. *   <code>message</code>: Notification body. *   <code>link</code>: Optional link. *   <code>type</code>: Relation to <code>TypeNotifyEntity</code>.</p>"},{"location":"backend/entities/#typenotify-typenotifyentityts","title":"TypeNotify (<code>type.notify.entity.ts</code>)","text":"<p>Defines types of notifications. *   <code>id</code>: Primary Key. *   <code>type</code>: Notification type name (unique).</p>"},{"location":"backend/entities/#usernotify-usernotifyentityts","title":"UserNotify (<code>user.notify.entity.ts</code>)","text":"<p>Associates notifications with users (recipient tracking). *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>notify</code>: Relation to <code>NotifyEntity</code>. *   <code>read</code>: Boolean indicating if the notification has been read.</p>"},{"location":"backend/entities/#system-systementityts","title":"System (<code>system.entity.ts</code>)","text":"<p>Stores system-wide configurations or legal texts. *   <code>id</code>: Primary Key. *   <code>termsAndConditions</code>: Terms and conditions text. *   <code>privacyPolicy</code>: Privacy policy text. *   <code>aboutUs</code>: About us text.</p>"},{"location":"backend/entities/#usersystem-usersystementityts","title":"UserSystem (<code>user.system.entity.ts</code>)","text":"<p>Associates users with system acceptances (e.g., terms accepted). *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>system</code>: Relation to <code>systemEntity</code>.</p>"},{"location":"backend/entities/#audit-auditentityts","title":"Audit (<code>audit.entity.ts</code>)","text":"<p>Logs system actions for auditing purposes. *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>action</code>: Action performed. *   <code>comment</code>: Additional details. *   <code>status</code>: Status of the action.</p>"},{"location":"backend/entities/#report-reportentityts","title":"Report (<code>report.entity.ts</code>)","text":"<p>Represents a user report (e.g., reporting a post or user). *   <code>id</code>: Primary Key. *   <code>user</code>: Relation to <code>UserEntity</code> (Reporter). *   <code>typeReport</code>: Relation to <code>TypeReportEntity</code>. *   <code>comments</code>: Report details.</p>"},{"location":"backend/entities/#typereport-typereportentityts","title":"TypeReport (<code>type.report.entity.ts</code>)","text":"<p>Defines types of reports. *   <code>id</code>: Primary Key. *   <code>type</code>: Report type name (unique).</p>"},{"location":"backend/entities/#commentsupportid-commentsupportidentityts","title":"CommentSupportId (<code>comment.supportid.entity.ts</code>)","text":"<p>Stores comments related to support ID verification. *   <code>id</code>: Primary Key. *   <code>comment</code>: Comment text. *   <code>user</code>: Relation to <code>UserEntity</code>. *   <code>status</code>: Relation to <code>StatusSupportIdEntity</code>. *   <code>processedBy</code>: ID of the admin who processed it. *   <code>processedAt</code>: Timestamp of processing. *   <code>rejectReason</code>: Reason for rejection.</p>"},{"location":"backend/entities/#statussupportid-statussupportidentityts","title":"StatusSupportId (<code>status.supportid.entity.ts</code>)","text":"<p>Defines statuses for support ID verification. *   <code>id</code>: Primary Key. *   <code>name</code>: Status name.</p>"},{"location":"backend/guards/","title":"Guards","text":"<p>Guards are responsible for authorizing requests based on certain conditions (permissions, roles, ACLs, etc.).</p>"},{"location":"backend/guards/#jwtauthguard","title":"JwtAuthGuard","text":"<ul> <li>Path: <code>src/shared/guards/jwt-auth.guard.ts</code></li> <li>Purpose: Ensures that the request contains a valid JWT token.</li> <li>Usage: Applied to endpoints that require authentication.</li> <li>Mechanism: Extends <code>AuthGuard('jwt')</code> from <code>@nestjs/passport</code>. It validates the token found in the <code>Authorization</code> header.</li> </ul>"},{"location":"backend/guards/#rolesguard","title":"RolesGuard","text":"<ul> <li>Path: <code>src/shared/guards/roles.guard.ts</code></li> <li>Purpose: Restricts access to endpoints based on user roles.</li> <li>Usage: Used in conjunction with the <code>@Roles()</code> decorator.</li> <li>Mechanism:<ol> <li>Retrieves required roles from the route handler metadata.</li> <li>Checks if the authenticated user (attached to the request) has one of the required roles.</li> <li>Returns <code>true</code> if authorized, <code>false</code> otherwise.</li> </ol> </li> </ul>"},{"location":"backend/guards/#wsrefreshguard","title":"WsRefreshGuard","text":"<ul> <li>Path: <code>src/shared/guards/ws-refresh.guard.ts</code></li> <li>Purpose: Specialized guard for WebSocket connections or specific refresh scenarios.</li> <li>Usage: Protects WebSocket gateways or refresh endpoints.</li> </ul>"},{"location":"backend/how-it-works/","title":"How It Works","text":"<p>This section explains the core workflows and business logic of the DonarApp backend through code examples from the most important services.</p>"},{"location":"backend/how-it-works/#authentication-flow","title":"Authentication Flow","text":"<p>The authentication system handles user registration, login, email verification, and password recovery.</p>"},{"location":"backend/how-it-works/#user-registration","title":"User Registration","text":"<p>When a user registers, the system: 1. Validates and hashes the password 2. Creates the user record 3. Sends a verification email with a code and token 4. Logs the action in the audit system</p> <pre><code>async registerUser(dto: CreateUserDto): Promise&lt;{ message: string, statussCode: number }&gt; {\n  // Validate password\n  if(!dto.password || dto.password.length &lt; 8) {\n    throw new InternalServerErrorException('La contrase\u00f1a debe tener al menos 8 caracteres.');\n  }\n\n  // Hash password\n  const salt = await bcrypt.genSalt(10);\n  const hashedPassword = await bcrypt.hash(dto.password, salt);\n  dto.password = hashedPassword;\n\n  // Create user\n  user = await this.userService.create(dto);\n\n  // Send verification email\n  await this.sendEmailVerification(user.email, user.username, user.id);\n\n  // Add user to system terms\n  await this.userSystemService.addUserToSystem(user.id);\n\n  // Log action\n  await this.auditService.createLog(user.id, 'registerUser', ...);\n\n  return { message: 'Usuario registrado exitosamente.', statussCode: 200 };\n}\n</code></pre>"},{"location":"backend/how-it-works/#login-with-security","title":"Login with Security","text":"<p>The login process includes: - Account lock mechanism after failed attempts - Email verification check - Block status validation - JWT token generation</p> <pre><code>async login(dto: LoginDto): Promise&lt;any&gt; {\n  const { email, password } = dto;\n  const user = await this.userRepository.findOne({ where: { email }, relations: ['rol'] });\n\n  if (!user) {\n    throw new UnauthorizedException('Credenciales inv\u00e1lidas.');\n  }\n\n  // Check email verification\n  if (!user.emailVerified) {\n    throw new UnauthorizedException('Correo electr\u00f3nico no verificado.');\n  }\n\n  // Check if account is blocked\n  if (user.block) {\n    throw new UnauthorizedException('Cuenta de usuario bloqueada.');\n  }\n\n  // Check temporary lock (after multiple failed attempts)\n  if (this.isLocked(user)) {\n    const minutes = Math.ceil((user.lockUntil!.getTime() - Date.now()) / 60000);\n    throw new UnauthorizedException(`Cuenta bloqueada temporalmente. Intenta en ${minutes} min.`);\n  }\n\n  // Verify password\n  const isPasswordMatching = await bcrypt.compare(password, user.password);\n  if (!isPasswordMatching) {\n    await this.registerFailedAttempt(user);\n    throw new UnauthorizedException('Credenciales inv\u00e1lidas.');\n  }\n\n  // Reset login attempts and update last login\n  await this.resetLoginAttempts(user.id);\n  await this.updateLastLogin(user.id);\n\n  // Generate JWT token\n  const token = await this.generateToken(user);\n\n  return {\n    message: 'Inicio de sesi\u00f3n exitoso.',\n    access_token: token.access_token,\n  };\n}\n</code></pre>"},{"location":"backend/how-it-works/#donation-creation-workflow","title":"Donation Creation Workflow","text":"<p>The donation system is the core of the application. It handles complex validation logic to ensure donations are valid and properly tracked.</p>"},{"location":"backend/how-it-works/#creating-a-donation","title":"Creating a Donation","text":"<p>The donation creation process: 1. Validates the user is verified 2. Checks the post exists and validates article availability 3. Determines donor/beneficiary based on post type 4. Creates the donation record 5. Links articles to the donation 6. Sends notifications to the post owner</p> <pre><code>async createDonation(createDonationDto: CreateDonationDto, currentUser: any): Promise&lt;DonationEntity&gt; {\n  const { postId, lugarRecogida, articles, fechaMaximaEntrega } = createDonationDto;\n\n  // Validate user is verified\n  const currentUserEntity = await this.userService.findById(currentUserId);\n  if (!currentUserEntity.verified) {\n    throw new ForbiddenException('Solo usuarios verificados pueden crear donaciones');\n  }\n\n  // Get post and validate\n  const post = await this.postService.getPostById(Number(postId));\n  if (!post) throw new NotFoundException('Post no encontrado');\n\n  // Determine if this is a \"solicitud de donacion\" (request for donation)\n  const typePostName = post.typePost?.type?.toLowerCase?.() || null;\n  const isSolicitudDonacion = typePostName === 'solicitud de donacion';\n\n  // Determine receiver based on post type\n  let receiver: any;\n  if (isSolicitudDonacion) {\n    // For donation requests, the post owner receives\n    receiver = post.user;\n    if (currentUserEntity.id === post.user.id) {\n      throw new ForbiddenException('No puedes donar a tu propia solicitud');\n    }\n  } else {\n    // For donation offers, the current user receives\n    receiver = currentUserEntity;\n    if (currentUserEntity.id === post.user.id) {\n      throw new ForbiddenException('No puedes crear una donaci\u00f3n para tu propio post');\n    }\n  }\n\n  // Validate receiver is an organization\n  const receiverRol = receiver.rol?.rol?.toLowerCase();\n  if (receiverRol !== 'organizacion') {\n    throw new ForbiddenException('Solo usuarios con rol \"organizacion\" pueden recibir donaciones');\n  }\n\n  // Validate articles availability\n  const postArticles = await this.postArticleService.findByPost(Number(postId));\n  const statusAvailable = await this.statusArticleDonationService.getStatusByName('disponible');\n\n  for (const item of articles) {\n    const articleData = postArticleMap.get(item.articlePostId);\n\n    // Check quantity\n    if (item.quantity &gt; articleData.quantity) {\n      throw new BadRequestException('Cantidad solicitada excede la disponible');\n    }\n\n    // Check status\n    if (articleData.statusId !== statusAvailable.id) {\n      throw new BadRequestException('Art\u00edculo no disponible para donaci\u00f3n');\n    }\n  }\n\n  // Create donation\n  const donation = this.donationRepo.create({\n    lugarRecogida,\n    fechaMaximaEntrega,\n    statusDonation: statusPendiente,\n    user: receiver,\n    post: { id: post.id },\n  });\n\n  const savedDonation = await this.donationRepo.save(donation);\n\n  // Link articles to donation\n  for (const [postArticleId, quantity] of requestedByPostArticle.entries()) {\n    await this.postDonationArticleService.addArticleToDonation({\n      postArticleId,\n      donationId: savedDonation.id,\n      quantity\n    });\n  }\n\n  // Send notification to post owner\n  await this.notifyService.createNotify({\n    title: 'Nueva Donaci\u00f3n',\n    message: `Nueva donaci\u00f3n creada para tu post \"${post.title}\"`,\n    link: `${urlFront}/organization/donations/${savedDonation.id}`,\n    typeNotifyId: typeNotifyId,\n    usersIds: [postOwnerUserId]\n  });\n\n  return donationWithArticles;\n}\n</code></pre>"},{"location":"backend/how-it-works/#post-management","title":"Post Management","text":"<p>Posts are the central entity for donation offers and requests. The system handles image uploads, tagging, and article management.</p>"},{"location":"backend/how-it-works/#creating-a-post-with-images-and-articles","title":"Creating a Post with Images and Articles","text":"<pre><code>async createPost(data: any, files?: Express.Multer.File[]): Promise&lt;PostEntity&gt; {\n  const { tags, typePost, user, articles, ...rest } = data;\n\n  // Validate required fields\n  if (!rest.title || !rest.message) {\n    throw new Error('title y message son obligatorios');\n  }\n\n  // Validate post type\n  const existTypePost = await this.typePostService.findById(typePost.id);\n  if (!existTypePost) {\n    throw new NotFoundException('El tipo de post no existe');\n  }\n\n  // Special validation for \"solicitud de donacion\"\n  if (existTypePost.type.toLowerCase() === 'solicitud de donacion') {\n    const userEntity = await this.userService.findById(userId);\n    const userRol = userEntity.rol?.rol?.toLowerCase();\n\n    if (userRol !== 'organizacion') {\n      throw new ForbiddenException(\n        'Solo usuarios con rol \"organizacion\" pueden crear solicitudes de donaci\u00f3n'\n      );\n    }\n  }\n\n  // Validate file sizes\n  if (files &amp;&amp; files.length &gt; 0) {\n    for (const file of files) {\n      const validation = await this.imagePostService.verifyFileSize(file);\n      if (validation.status === 413) {\n        throw new HttpException('Archivo demasiado grande', 413);\n      }\n    }\n  }\n\n  // Create post\n  const newPost = this.postRepository.create({\n    title: rest.title,\n    message: rest.message,\n    user: { id: userId },\n    typePost: existTypePost,\n  });\n\n  const savedPost = await this.postRepository.save(newPost);\n  const postId = savedPost.id;\n\n  // Add tags\n  if (tags) {\n    for (const tagName of tags) {\n      let tagEntity;\n      try {\n        tagEntity = await this.tagsService.getTabByName(tagName);\n      } catch (err) {\n        tagEntity = await this.tagsService.createTag(tagName);\n      }\n      await this.postTagsService.createPostTag(postId, tagEntity.id);\n    }\n  }\n\n  // Add articles\n  if (articles &amp;&amp; articles.length &gt; 0) {\n    for (const item of articles) {\n      let articleId;\n\n      // Check if article exists by name\n      try {\n        const exist = await this.articleService.getArticleByName(item.name);\n        articleId = exist?.id;\n      } catch (err) {\n        // Create new article if it doesn't exist\n        const created = await this.articleService.createArticle({\n          name: item.name,\n          description: item.description\n        });\n        articleId = created?.id;\n      }\n\n      // Link article to post\n      await this.postArticleService.addPostArticle({\n        post: postId,\n        article: articleId,\n        quantity: item.quantity || 1\n      }, userId);\n    }\n  }\n\n  // Upload images\n  if (files &amp;&amp; files.length &gt; 0) {\n    for (const file of files) {\n      await this.imagePostService.addImageToPost(postId, file);\n    }\n  }\n\n  return await this.getPostById(postId);\n}\n</code></pre>"},{"location":"backend/how-it-works/#optimized-post-retrieval-with-like-status","title":"Optimized Post Retrieval with Like Status","text":"<p>The system efficiently retrieves posts with user-specific data (like status) without N+1 queries:</p> <pre><code>async findAll(userId?: number, limit: number = 20, cursor?: number): Promise&lt;PostEntity[]&gt; {\n  // Build query with all relations\n  const query = this.postRepository.createQueryBuilder('post')\n    .leftJoinAndSelect('post.imagePost', 'imagePost')\n    .leftJoinAndSelect('post.tags', 'postTags')\n    .leftJoinAndSelect('postTags.tag', 'tag')\n    .leftJoinAndSelect('post.user', 'user')\n    .leftJoinAndSelect('post.postArticle', 'postArticle')\n    .leftJoinAndSelect('postArticle.article', 'article')\n    .leftJoinAndSelect('post.typePost', 'typePost');\n\n  // Cursor-based pagination\n  if (cursor &amp;&amp; cursor &gt; 0) {\n    query.andWhere('post.id &lt; :cursor', { cursor });\n  }\n\n  query.orderBy('post.id', 'DESC').take(limit);\n\n  const posts = await query.getMany();\n\n  // Batch query to check which posts the user has liked (avoid N+1)\n  let userLikedPostIds: Set&lt;number&gt; = new Set();\n  if (userId &amp;&amp; userId &gt; 0) {\n    const postIds = posts.map(post =&gt; post.id);\n    const userLikes = await this.postRepository\n      .createQueryBuilder('post')\n      .innerJoin('post.postLiked', 'liked')\n      .where('post.id IN (:...postIds)', { postIds })\n      .andWhere('liked.user.id = :userId', { userId })\n      .select('post.id')\n      .getMany();\n\n    userLikedPostIds = new Set(userLikes.map(post =&gt; post.id));\n  }\n\n  // Enrich posts with user-specific data\n  return posts.map(post =&gt; {\n    // Sanitize user data\n    if (post.user) {\n      const { id, username, profilePhoto, emailVerified, verified } = post.user;\n      post.user = { id, username, profilePhoto, emailVerified, verified };\n    }\n\n    // Add like status\n    if (userId &amp;&amp; userId &gt; 0) {\n      (post as any).userHasLiked = userLikedPostIds.has(post.id);\n    }\n\n    // Add likes count\n    (post as any).likesCount = post.postLiked?.length || 0;\n\n    return post;\n  });\n}\n</code></pre>"},{"location":"backend/how-it-works/#key-design-patterns","title":"Key Design Patterns","text":""},{"location":"backend/how-it-works/#1-audit-logging","title":"1. Audit Logging","text":"<p>Every critical operation is logged with user ID, action, payload, and response for security and debugging.</p>"},{"location":"backend/how-it-works/#2-role-based-access-control","title":"2. Role-Based Access Control","text":"<p>The system enforces strict role checks, especially for organization-only features like receiving donations.</p>"},{"location":"backend/how-it-works/#3-optimized-queries","title":"3. Optimized Queries","text":"<p>Uses batch queries and <code>loadRelationCountAndMap</code> to avoid N+1 query problems.</p>"},{"location":"backend/how-it-works/#4-data-sanitization","title":"4. Data Sanitization","text":"<p>Sensitive user data (passwords, tokens, etc.) is always removed before sending responses.</p>"},{"location":"backend/how-it-works/#5-notification-system","title":"5. Notification System","text":"<p>Automatically notifies users of important events (new donations, status changes, etc.).</p>"},{"location":"backend/interceptors/","title":"Interceptors","text":"<p>Interceptors have a set of useful capabilities which are inspired by the Aspect Oriented Programming (AOP) technique.</p>"},{"location":"backend/interceptors/#addrefreshtokeninterceptor","title":"AddRefreshTokenInterceptor","text":"<ul> <li>Path: <code>src/shared/interceptors/add-refresh-token.interceptor.ts</code></li> <li>Purpose: Intercepts the response to attach a refresh token.</li> <li>Usage: Typically used in login or token refresh endpoints.</li> <li>Mechanism:<ol> <li>Intercepts the outgoing response.</li> <li>Extracts the refresh token from the result.</li> <li>Sets it as an HTTP-only cookie or in the response header, depending on the implementation.</li> </ol> </li> </ul>"},{"location":"backend/middleware/","title":"Middleware","text":"<p>Middleware is a function which is called before the route handler.</p>"},{"location":"backend/middleware/#refreshtokenmiddleware","title":"RefreshTokenMiddleware","text":"<ul> <li>Path: <code>src/shared/middleware/refresh-token.middleware.ts</code></li> <li>Purpose: Handles the extraction and validation of refresh tokens from incoming requests.</li> <li>Usage: Applied to routes that require token refreshing.</li> <li>Mechanism:<ol> <li>Checks for the presence of a refresh token in cookies or headers.</li> <li>Validates the token format.</li> <li>Attaches the token payload or the token itself to the request object for downstream use.</li> </ol> </li> </ul>"},{"location":"backend/modules/","title":"Backend Modules","text":"<p>The application is divided into several feature modules. Each module encapsulates specific functionality, often mapping to database entities or specific business logic domains.</p>"},{"location":"backend/modules/#module-overview","title":"Module Overview","text":"Module Description Category Article Manages generic articles or items. Feature Audit Handles system auditing, tracking user actions and system events. Core Auth Authentication and authorization, managing login, registration, and JWT tokens. Core Chat Real-time chat functionality using WebSockets. Core ChatStatus Manages statuses for chat sessions. Helper CommentSupportId Manages comments related to support ID verification. Helper Countries Manages location data (Countries, States, Cities) using an external API. Core Donation Manages donations, including tracking status and history. Core DonationReview Manages reviews for donations, integrating with Pysentimiento. Feature ImagePost Manages images associated with posts. Helper MessageChat Handles individual chat messages. Feature Notify Notification system for sending alerts to users. Core People Manages personal information profiles linked to users. Feature Post Handles user posts, including creation and interactions. Core PostArticle Manages articles associated with a post. Helper PostDonationArticle Manages the relationship between donations and articles (items donated). Helper PostLiked Tracks likes on posts. Feature PostTags Manages tags associated with posts. Helper Report Reporting system for content or user issues. Core Rol Role management, defining permissions for different user types. Core Statistics System statistics and analytics. Core StatusArticleDonation Manages statuses for articles within a donation. Helper StatusDonation Manages statuses for donations. Helper StatusSupportId Manages statuses for support ID verification. Helper System System configurations and settings. Core Tags Manages available tags for posts. Feature TypeDni Manages types of identification documents. Helper TypeMessage Manages types of chat messages. Helper TypeNotify Manages types of notifications. Helper TypePost Manages types of posts. Helper TypeReport Manages types of reports. Helper User User management, profile updates, and user retrieval. Core UserArticle Manages articles associated with a user (inventory/needs). Helper UserChat Manages the relationship between users and chats. Helper UserNotify Manages the relationship between users and notifications. Helper UserSystem Manages user acceptance of system terms/policies. Helper"},{"location":"backend/modules/#module-structure","title":"Module Structure","text":"<p>Each module typically contains: - <code>*.module.ts</code>: The module definition file. - <code>*.controller.ts</code>: The API controller. - <code>*.service.ts</code>: The business logic service. - <code>dto/</code>: Data Transfer Objects for validation. - <code>entity/</code>: Database entities.</p>"},{"location":"backend/services/","title":"Services","text":"<p>Services contain the business logic of the application. They interact with the database via repositories and are injected into controllers.</p>"},{"location":"backend/services/#key-services","title":"Key Services","text":""},{"location":"backend/services/#authservice-authservicets","title":"AuthService (<code>auth.service.ts</code>)","text":"<ul> <li>validateUser(email, pass): Verifies if the user exists and if the password matches the hash.</li> <li>login(user): Generates <code>accessToken</code> and <code>refreshToken</code> for a validated user.</li> <li>register(dto): Hashes the password and creates a new user record via <code>UserService</code>.</li> </ul>"},{"location":"backend/services/#services_1","title":"Services","text":"<p>Services contain the business logic of the application. They interact with the database via repositories and are injected into controllers.</p>"},{"location":"backend/services/#key-services_1","title":"Key Services","text":""},{"location":"backend/services/#authservice-authservicets_1","title":"AuthService (<code>auth.service.ts</code>)","text":"<ul> <li>validateUser(email, pass): Verifies if the user exists and if the password matches the hash.</li> <li>login(user): Generates <code>accessToken</code> and <code>refreshToken</code> for a validated user.</li> <li>register(dto): Hashes the password and creates a new user record via <code>UserService</code>.</li> </ul>"},{"location":"backend/services/#userservice-userservicets","title":"UserService (<code>user.service.ts</code>)","text":"<ul> <li>findAll(): Returns all users from the database.</li> <li>findOne(id): Finds a user by ID.</li> <li>create(dto): Creates a new user entity and saves it.</li> <li>update(id, dto): Updates an existing user.</li> </ul>"},{"location":"backend/services/#donation-service-donationservicets","title":"Donation Service (<code>donation.service.ts</code>)","text":"<ul> <li>Logic:<ul> <li><code>create</code>: Creates a new donation, validating the post and articles.</li> <li><code>updateStatus</code>: Updates the status of a donation (e.g., pending, accepted, rejected).</li> <li><code>findByUser</code>: Retrieves donations for a specific user.</li> </ul> </li> </ul>"},{"location":"backend/services/#donation-review-service-donationreviewservicets","title":"Donation Review Service (<code>donationreview.service.ts</code>)","text":"<ul> <li>Logic:<ul> <li><code>createReview</code>: Allows a beneficiary to review a donation.</li> <li>Sentiment Analysis: Integrates with a Pysentimiento microservice to analyze the review text. It sends the text to the microservice and receives a sentiment score (converted to a 1-5 rating), which is then saved with the review.</li> <li><code>getReviewsByDonationId</code>: Retrieves reviews for a specific donation.</li> </ul> </li> </ul>"},{"location":"backend/services/#countries-service-countriesservicets","title":"Countries Service (<code>countries.service.ts</code>)","text":"<ul> <li>Logic:<ul> <li>External API: Connects to an external Country State City API (https://docs.countrystatecity.in/) to fetch location data.</li> <li><code>getCountriesData</code>: Fetches and caches (conceptually) the list of countries.</li> <li><code>getStatesByCountry</code>: Fetches states for a given country ISO code.</li> <li><code>getCitiesByState</code>: Fetches cities for a given state and country.</li> <li>Uses <code>URL_COUNTRIES_API</code> and <code>API_KEY_COUNTRIES_API</code> from configuration.</li> </ul> </li> </ul>"},{"location":"backend/services/#ai-service-iaservicets","title":"AI Service (<code>ia.service.ts</code>)","text":"<ul> <li>Logic:<ul> <li>Image Analysis: Uses Google Gemini AI (<code>gemini-2.5-flash</code>) to analyze uploaded images.</li> <li><code>getTagsFromImages</code>: Accepts image files, sends them to Gemini with a prompt to generate 5 descriptive tags, and returns these tags as a list of strings.</li> <li>Fallback: If Gemini fails, it attempts to use AWS Rekognition (via <code>RespaldoiaService</code>) to detect labels in the images, ensuring high availability for image processing features.</li> </ul> </li> </ul>"}]}